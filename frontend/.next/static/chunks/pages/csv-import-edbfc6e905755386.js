(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{6357:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/csv-import",function(){return r(6552)}])},5415:function(e,t,r){"use strict";r.d(t,{Z:function(){return ProtectedRoute}});var o=r(5893),n=r(7294),a=r(1163),s=r(1144);function ProtectedRoute(e){let{children:t}=e,{token:r,isLoading:i}=(0,s.aC)(),l=(0,a.useRouter)(),[c,d]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{i||r||(console.log("\uD83D\uDD12 Usu\xe1rio n\xe3o autenticado, redirecionando para login..."),d(!0),l.replace("/login"))},[r,i,l]),i||c||!r)?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,o.jsx)("p",{className:"text-gray-600",children:i?"Carregando...":"Verificando autentica\xe7\xe3o..."})]})}):(0,o.jsx)(o.Fragment,{children:t})}},6552:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CSVImport}});var o=r(5893),n=r(7294),a=r(1144),s=r(1163),i=r(5415);let CSVImportContent=()=>{let{token:e}=(0,a.aC)(),t=(0,s.useRouter)(),[r,i]=(0,n.useState)(null),[l,c]=(0,n.useState)("accounts"),[d,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)(""),[x,h]=(0,n.useState)(""),[f,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{b(!0)},[]),(0,n.useEffect)(()=>{f&&!e&&t.push("/login")},[f,e,t]);let handleImport=async()=>{if(!r){h("Por favor, selecione um arquivo CSV");return}u(!0),h(""),p("");let t=new FormData;t.append("file",r);try{let r="http://127.0.0.1:8000",o=r.startsWith("http://")?r.replace("http://","https://"):r,n=await fetch("".concat(o.replace(/\/$/,""),"/csv/import/").concat(l),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:t}),a=await n.json();if(n.ok){p("Importa\xe7\xe3o realizada com sucesso! ".concat(a.imported_count||a.accounts_imported||0," registros importados.")),i(null);let e=document.getElementById("file-input");e&&(e.value="")}else h(a.detail||a.message||"Erro na importa\xe7\xe3o")}catch(e){h("Erro ao conectar com o servidor")}finally{u(!1)}},downloadTemplate=async t=>{try{let r="http://127.0.0.1:8000",o=r.startsWith("http://")?r.replace("http://","https://"):r,n=await fetch("".concat(o.replace(/\/$/,""),"/csv/template/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(n.ok){let e=await n.json(),t=new Blob([e.template],{type:"text/csv"}),r=window.URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=e.filename,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(r),document.body.removeChild(o)}else h("Erro ao baixar template")}catch(e){h("Erro ao baixar template")}};return f?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,o.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Importar CSV"}),(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Importa\xe7\xe3o"}),(0,o.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,o.jsx)("option",{value:"accounts",children:"Contas"}),(0,o.jsx)("option",{value:"transactions",children:"Transa\xe7\xf5es"}),(0,o.jsx)("option",{value:"groups",children:"Grupos"}),(0,o.jsx)("option",{value:"subgroups",children:"Subgrupos"})]})]}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{type:"button",onClick:()=>downloadTemplate(l),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Baixar Template"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar Arquivo CSV"}),(0,o.jsx)("input",{id:"file-input",type:"file",accept:".csv",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&r.name.endsWith(".csv")?(i(r),h("")):(h("Por favor, selecione um arquivo CSV v\xe1lido"),i(null))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),x&&(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,o.jsx)("p",{className:"text-red-800",children:x})}),m&&(0,o.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:(0,o.jsx)("p",{className:"text-green-800",children:m})}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{type:"button",onClick:handleImport,disabled:!r||d,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Importando...":"Importar CSV"})})]})]})})}):(0,o.jsx)("div",{children:"Carregando..."})};function CSVImport(){return(0,o.jsx)(i.Z,{children:(0,o.jsx)(CSVImportContent,{})})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=6357)}),_N_E=e.O()}]);