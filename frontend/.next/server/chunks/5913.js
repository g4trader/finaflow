exports.id=5913,exports.ids=[5913],exports.modules={1144:(e,t,a)=>{"use strict";a.a(e,async(e,r)=>{try{a.d(t,{Ho:()=>AuthProvider,Vo:()=>c,aC:()=>useAuth});var o=a(997),n=a(6689),s=a(5567),i=a.n(s),u=a(5843),l=e([u]);u=(l.then?(await l)():l)[0];let c=(0,n.createContext)({}),useAuth=()=>{let e=(0,n.useContext)(c);if(!e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e},setCookie=(e,t,a)=>{},removeCookie=e=>{},AuthProvider=({children:e})=>{let[t,a]=(0,n.useState)(null),[r,s]=(0,n.useState)(null),[l,d]=(0,n.useState)(!0),[p,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{d(!1)},[]);let login=async(e,t)=>{try{console.log("\uD83D\uDD10 [AuthContext] Iniciando login...",{username:e}),localStorage.removeItem("token"),removeCookie("auth-token"),console.log("\uD83D\uDCE1 [AuthContext] Chamando API de login...");let r=await (0,u.x4)(e,t);console.log("✅ [AuthContext] API retornou:",{has_token:!!r.access_token,token_type:r.token_type,expires_in:r.expires_in}),a(r.access_token),localStorage.setItem("token",r.access_token),setCookie("auth-token",r.access_token,7),console.log("\uD83D\uDD13 [AuthContext] Decodificando token...");let o=i()(r.access_token);console.log("✅ [AuthContext] Token decodificado:",{username:o.username,role:o.role,tenant_id:o.tenant_id,business_unit_id:o.business_unit_id});let n={id:o.sub,username:o.username,email:o.email,first_name:o.first_name||"",last_name:o.last_name||"",role:o.role,tenant_id:o.tenant_id,business_unit_id:o.business_unit_id,department_id:o.department_id};s(n),console.log("\uD83D\uDC64 [AuthContext] Usu\xe1rio configurado");try{console.log("\uD83D\uDD0D [AuthContext] Verificando necessidade de sele\xe7\xe3o de BU...");let e=await (0,u.VJ)();console.log("\uD83D\uDCCB [AuthContext] Resposta da verifica\xe7\xe3o de BU:",e),h(e.needs_selection)}catch(t){console.error("⚠️ [AuthContext] Erro ao verificar necessidade de sele\xe7\xe3o de BU:",t);let e=!o.business_unit_id;console.log(`📋 [AuthContext] Fallback - Precisa BU: ${e}`),h(e)}console.log("✅ [AuthContext] Login completo!")}catch(e){throw console.error("❌ [AuthContext] Erro no login:",e),e}},signup=async e=>{let a=await (0,u.IU)(e,t??void 0);return a},logout=()=>{a(null),s(null),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refresh-token"),removeCookie("auth-token")},refreshToken=async()=>{try{let e=localStorage.getItem("refresh-token");if(!e)throw Error("Refresh token n\xe3o encontrado");let t=await fetch("http://127.0.0.1:8000/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)throw Error("Falha ao renovar token");let r=await t.json();a(r.access_token),localStorage.setItem("token",r.access_token),setCookie("auth-token",r.access_token,7);let o=i()(r.access_token);s({id:o.sub,username:o.username,email:o.email,first_name:o.first_name||"",last_name:o.last_name||"",role:o.role,tenant_id:o.tenant_id,business_unit_id:o.business_unit_id,department_id:o.department_id})}catch(e){console.error("Erro ao renovar token:",e),logout()}};return o.jsx(c.Provider,{value:{token:t,user:r,login,signup,logout,isLoading:l,refreshToken,role:r?.role||null,tenantId:r?.tenant_id||null,needsBusinessUnitSelection:p,setNeedsBusinessUnitSelection:h},children:e})};r()}catch(e){r(e)}})},5913:(e,t,a)=>{"use strict";a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var o=a(997),n=a(1144);a(6764);var s=a(1163),i=a(6689),u=e([n]);function RouteProtection({children:e}){let{token:t,isLoading:a}=(0,n.aC)(),r=(0,s.useRouter)(),u=["/dashboard","/accounts","/groups","/subgroups","/users","/forecast","/reports","/settings","/csv-import"],l=["/login","/signup","/forgot-password","/"];return((0,i.useEffect)(()=>{if(!a){let e=r.pathname,a=u.some(t=>e.startsWith(t));if(l.some(t=>e.startsWith(t)),a&&!t){console.log(`🔒 RouteProtection: Redirecionando ${e} para login`),r.replace("/login");return}if(t&&("/login"===e||"/signup"===e)){console.log(`🔄 RouteProtection: Usu\xe1rio autenticado tentando acessar ${e}, redirecionando para dashboard`),r.replace("/dashboard");return}}},[t,a,r]),a)?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})}):o.jsx(o.Fragment,{children:e})}n=(u.then?(await u)():u)[0];let __WEBPACK_DEFAULT_EXPORT__=function({Component:e,pageProps:t}){return o.jsx(n.Ho,{children:o.jsx(RouteProtection,{children:o.jsx(e,{...t})})})};r()}catch(e){r(e)}})},5843:(e,t,a)=>{"use strict";a.a(e,async(e,r)=>{try{a.d(t,{$h:()=>getUserPermissions,A5:()=>importFromGoogleSheets,B6:()=>getChartAccountsHierarchy,DS:()=>getTenants,G:()=>deleteBusinessUnit,HE:()=>importCsv,IH:()=>selectBusinessUnit,IU:()=>signup,Jq:()=>updateTenant,Kh:()=>createForecast,LS:()=>createTenant,MB:()=>getCashFlowReport,Me:()=>updateForecast,Nq:()=>updateUser,Rf:()=>getUsers,Rm:()=>deleteSubgroup,T8:()=>getAccounts,T9:()=>updateSubgroup,VJ:()=>needsBusinessUnitSelection,Xx:()=>updateUserPermissions,ZP:()=>u,Zu:()=>getPermissions,_u:()=>getChartAccountGroups,a:()=>getForecasts,ap:()=>importChartAccounts,aq:()=>getChartAccountSubgroups,ax:()=>getSampleSpreadsheetInfo,bG:()=>getUserInfo,e8:()=>deleteForecast,f1:()=>getTransactions,h8:()=>deleteUser,iE:()=>deleteGroup,j3:()=>createBusinessUnit,jc:()=>validateGoogleSheetsData,kD:()=>getCashFlow,l9:()=>getSubgroups,mD:()=>updateGroup,mu:()=>getBusinessUnits,o1:()=>createAccount,p0:()=>updateBusinessUnit,r4:()=>createUser,sG:()=>updateAccount,sS:()=>createGroup,tm:()=>deleteAccount,x4:()=>login,xB:()=>getUserBusinessUnits,yF:()=>createSubgroup,yO:()=>deleteTenant});var o=a(9648),n=e([o]);o=(n.then?(await n)():n)[0];let s="http://127.0.0.1:8000",i=o.default.create({baseURL:s,headers:{"Content-Type":"application/json"},withCredentials:!1});i.interceptors.request.use(e=>e),i.interceptors.response.use(e=>e,async e=>{if(e.response?.status===401)try{let t=localStorage.getItem("refresh-token");if(t){let a=await o.default.post(`${s}/api/v1/auth/refresh`,{refresh_token:t}),r=a.data.access_token;return localStorage.setItem("token",r),e.config.headers.Authorization=`Bearer ${r}`,(0,o.default)(e.config)}}catch(e){localStorage.removeItem("token"),localStorage.removeItem("refresh-token"),window.location.href="/login"}return Promise.reject(e)});let login=async(e,t)=>{console.log("\uD83D\uDCE1 [API] Preparando login...",{username:e,api_url:s});try{console.log("\uD83D\uDCE4 [API] Tentando via proxy /api/proxy-login");let a=await o.default.post("/api/proxy-login",{username:e,password:t});return console.log("\uD83D\uDCE5 [API] Resposta do proxy recebida:",{status:a.status,has_access_token:!!a.data.access_token}),a.data.refresh_token&&(localStorage.setItem("refresh-token",a.data.refresh_token),console.log("\uD83D\uDCBE [API] Refresh token salvo")),a.data}catch(o){console.error("❌ [API] Erro no proxy, tentando direto...",o.message);let a=new FormData;a.append("username",e),a.append("password",t),console.log("\uD83D\uDCE4 [API] Enviando requisi\xe7\xe3o direta para /api/v1/auth/login");let r=await i.post("/api/v1/auth/login",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return console.log("\uD83D\uDCE5 [API] Resposta recebida:",{status:r.status,has_access_token:!!r.data.access_token,has_refresh_token:!!r.data.refresh_token}),r.data.refresh_token&&(localStorage.setItem("refresh-token",r.data.refresh_token),console.log("\uD83D\uDCBE [API] Refresh token salvo")),r.data}},signup=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/users",e,{headers:a});return r.data},getUserBusinessUnits=async()=>{let e=localStorage.getItem("token");if(!e)throw console.error("❌ [API] Token n\xe3o encontrado no localStorage"),Error("Token n\xe3o encontrado");try{console.log("\uD83D\uDCE1 [API] Buscando business units via proxy...");let t=await o.default.get("/api/proxy-business-units",{headers:{Authorization:`Bearer ${e}`}});return console.log("✅ [API] Business units carregadas via proxy"),t.data}catch(t){console.error("❌ [API] Erro no proxy, tentando direto...",t.message);let e=await i.get("/api/v1/auth/user-business-units");return e.data}},selectBusinessUnit=async e=>{let t=localStorage.getItem("token");if(!t)throw console.error("❌ [API] Token n\xe3o encontrado para sele\xe7\xe3o de BU"),Error("Token n\xe3o encontrado");try{console.log("\uD83D\uDCE1 [API] Selecionando BU via proxy...",e);let a=await o.default.post("/api/proxy-select-bu",{business_unit_id:e},{headers:{Authorization:`Bearer ${t}`}});return console.log("✅ [API] BU selecionada via proxy"),a.data}catch(a){console.error("❌ [API] Erro no proxy de sele\xe7\xe3o, tentando direto...",a.message);let t=await i.post("/api/v1/auth/select-business-unit",{business_unit_id:e});return t.data}},getAccountSubgroups=async(e,t)=>{let a=e?{group_id:e}:{},r={};t&&(r.Authorization=`Bearer ${t}`);let o=await i.get("/api/v1/financial/account-subgroups",{params:a,headers:r});return o.data},getAccounts=async(e,t,a)=>{let r={};e&&(r.subgroup_id=e),t&&(r.account_type=t);let o={};a&&(o.Authorization=`Bearer ${a}`);let n=await i.get("/api/v1/financial/accounts",{params:r,headers:o});return n.data},createAccount=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/financial/accounts",e,{headers:a});return r.data},updateAccount=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/financial/accounts/${e}`,t,{headers:r});return o.data},deleteAccount=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/financial/accounts/${e}`,{headers:a});return r.data},getSubgroups=async(e,t)=>getAccountSubgroups(e,t),getTransactions=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.get("/api/v1/financial/transactions",{params:e,headers:a});return r.data},getCashFlow=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.get("/api/v1/financial/cash-flow",{params:e,headers:a});return r.data},getUsers=async e=>{let t={};e&&(t.Authorization=`Bearer ${e}`);let a=await i.get("/api/v1/users",{headers:t});return a.data},createUser=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/users",e,{headers:a});return r.data},deleteUser=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/users/${e}`,{headers:a});return r.data},getTenants=async e=>{let t={};e&&(t.Authorization=`Bearer ${e}`);let a=await i.get("/api/v1/tenants",{headers:t});return a.data},createTenant=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/tenants",e,{headers:a});return r.data},deleteTenant=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/tenants/${e}`,{headers:a});return r.data},getForecasts=async e=>{let t={};e&&(t.Authorization=`Bearer ${e}`);let a=await i.get("/api/v1/financial/forecasts",{headers:t});return a.data},createForecast=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/financial/forecasts",e,{headers:a});return r.data},updateForecast=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/financial/forecasts/${e}`,t,{headers:r});return o.data},deleteForecast=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/financial/forecasts/${e}`,{headers:a});return r.data},createGroup=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/financial/groups",e,{headers:a});return r.data},updateGroup=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/financial/groups/${e}`,t,{headers:r});return o.data},deleteGroup=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/financial/groups/${e}`,{headers:a});return r.data},createSubgroup=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/financial/account-subgroups",e,{headers:a});return r.data},updateSubgroup=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/financial/account-subgroups/${e}`,t,{headers:r});return o.data},deleteSubgroup=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/financial/account-subgroups/${e}`,{headers:a});return r.data},importCsv=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=new FormData;o.append("file",e),o.append("table",t);let n=await i.post("/api/v1/csv/import-csv",o,{headers:{...r,"Content-Type":"multipart/form-data"}});return n.data},getCashFlowReport=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.get("/api/v1/financial/cash-flow-report",{params:e,headers:a});return r.data},updateUser=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/users/${e}`,t,{headers:r});return o.data},updateTenant=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/tenants/${e}`,t,{headers:r});return o.data},getBusinessUnits=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r={};e&&(r.tenant_id=e);let o=await i.get("/api/v1/business-units",{headers:a,params:r});return o.data},createBusinessUnit=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/business-units",e,{headers:a});return r.data},updateBusinessUnit=async(e,t,a)=>{let r={};a&&(r.Authorization=`Bearer ${a}`);let o=await i.put(`/api/v1/business-units/${e}`,t,{headers:r});return o.data},deleteBusinessUnit=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.delete(`/api/v1/business-units/${e}`,{headers:a});return r.data},getUserInfo=async()=>{let e=await i.get("/api/v1/auth/user-info");return e.data},needsBusinessUnitSelection=async()=>{let e=await i.get("/api/v1/auth/needs-business-unit-selection");return e.data},getPermissions=async()=>{let e=await i.get("/api/v1/permissions");return e.data},getUserPermissions=async(e,t)=>{let a=await i.get(`/api/v1/permissions/users/${e}/business-units/${t}`);return a.data},updateUserPermissions=async(e,t,a)=>{let r=await i.put(`/api/v1/permissions/users/${e}/business-units/${t}`,{permissions:a});return r.data},getChartAccountsHierarchy=async e=>{try{let e=await i.get("/api/v1/chart-accounts/hierarchy");return e.data}catch(e){throw Error(e.response?.data?.detail||"Erro ao buscar hierarquia do plano de contas")}},getChartAccountGroups=async e=>{try{let e=await i.get("/api/v1/chart-accounts/groups");return e.data}catch(e){throw Error(e.response?.data?.detail||"Erro ao buscar grupos")}},getChartAccountSubgroups=async(e,t)=>{try{let t={};e&&(t.group_id=e);let a=await i.get("/api/v1/chart-accounts/subgroups",{params:t});return a.data}catch(e){throw Error(e.response?.data?.detail||"Erro ao buscar subgrupos")}},importChartAccounts=async(e,t)=>{try{let a=new FormData;a.append("file",e);let r={"Content-Type":"multipart/form-data"};t&&(r.Authorization=`Bearer ${t}`);let n=await o.default.post(`${s}/api/v1/chart-accounts/import`,a,{headers:r});return n.data}catch(e){throw Error(e.response?.data?.detail||"Erro ao importar plano de contas")}},getSampleSpreadsheetInfo=async e=>{let t={};e&&(t.Authorization=`Bearer ${e}`);let a=await i.get("/api/v1/import/google-sheets/sample",{headers:t});return a.data},validateGoogleSheetsData=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/import/google-sheets/validate",null,{params:{spreadsheet_id:e},headers:a});return r.data},importFromGoogleSheets=async(e,t)=>{let a={};t&&(a.Authorization=`Bearer ${t}`);let r=await i.post("/api/v1/import/google-sheets",e,{headers:a});return r.data},u=i;r()}catch(e){r(e)}})},6764:()=>{}};